<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>STOR7S | ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª (IT)</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');
body{font-family:Tajawal;background:#0b1220;color:#fff;margin:0;}
.topbar{background:#101d36;padding:15px;display:flex;justify-content:space-between;align-items:center;}
.btn{background:#3b82f6;border:0;padding:10px 15px;border-radius:8px;color:#fff;cursor:pointer;}
.btn.red{background:#ef4444;}
.btn.green{background:#22c55e;}
.card{background:#0f1b33;padding:20px;border-radius:12px;margin:10px;}
input,select,textarea{width:100%;padding:10px;margin-top:5px;border-radius:8px;background:#162544;color:#fff;border:1px solid #243b55;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.1);}
</style>
</head>

<body>

<div class="topbar">
  <div>ğŸ’» STOR7S | ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</div>
  <button class="btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<div class="card">
  <h2>ğŸ“© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>
  <button class="btn" onclick="loadIT()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
  <table id="tblIT"><tbody></tbody></table>
</div>

<div class="card">
  <h2>ğŸ› ï¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙÙ†ÙŠ</h2>
  <input id="req" type="number" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨">
  <select id="type">
  <option>ØµÙŠØ§Ù†Ø©</option>
  <option>ØªØ§Ù„Ù</option>
  <option>Ø§Ø³ØªØ¨Ø¯Ø§Ù„</option>
  <option>Ø¬Ù‡Ø§Ø² Ø¬Ø¯ÙŠØ¯</option>
</select>

<select id="recommend">
  <option>Ø´Ø±Ø§Ø¡</option>
  <option>ØµØ±Ù</option>
  <option>Ø§Ø³ØªØ¨Ø¯Ø§Ù„</option>
  <option>Ø¥ØºÙ„Ø§Ù‚</option>
</select>

<textarea id="notes" placeholder="Ø§Ù„ÙˆØµÙ Ø§Ù„ÙÙ†ÙŠ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ"></textarea>
<input id="tech" placeholder="Ø§Ø³Ù… Ø§Ù„ÙÙ†ÙŠ">


  <h3>ğŸ“ Ø±ÙØ¹ Ù…Ø±ÙÙ‚ Ù„Ù„ØªÙ‚Ø±ÙŠØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</h3>
  <input type="file" id="file">

  <button class="btn green" onclick="sendBack()">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯ Ù„Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</button>

    <div class="card">
  <h2>ğŸ›’ Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ Ø¬Ø¯ÙŠØ¯ (IT)</h2>

  <input id="desc" placeholder="ÙˆØµÙ Ø§Ù„Ø·Ù„Ø¨">

  <input id="item_name" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
  <input id="item_qty" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">

  <button class="btn green" onclick="sendPurchase()">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</button>
</div>

</div>


<script>
const API = "http://localhost:5000/api/it";

// ====================== Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù…Ù† Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ======================
async function loadIT(){
  let res = await fetch(API+"/incoming");
  let data = await res.json();
  let rows="";
  for(let r of data){
    rows += `
    <tr>
      <td>${r.Ø±Ù‚Ù…_Ø§Ù„Ø·Ù„Ø¨}</td>
      <td>${r.Ø§Ù„Ø­Ø§Ù„Ø©}</td>
    </tr>`;
  }
  document.querySelector("#tblIT tbody").innerHTML = rows;
}

// ====================== Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„ÙØ­Øµ ======================
async function sendBack(){
  let fd = new FormData();
  fd.append("Ø±Ù‚Ù…_Ø§Ù„Ø·Ù„Ø¨", document.getElementById("req").value);
  fd.append("Ù†ÙˆØ¹_Ø§Ù„ØªÙ‚ÙŠÙŠÙ…", document.getElementById("type").value);
  fd.append("Ø§Ù„ØªÙˆØµÙŠØ©", document.getElementById("recommend").value);
  fd.append("Ø§Ù„ÙˆØµÙ_Ø§Ù„ÙÙ†ÙŠ", document.getElementById("notes").value);
  fd.append("Ø§Ø³Ù…_Ø§Ù„ÙÙ†ÙŠ", document.getElementById("tech").value);

  let f = document.getElementById("file").files[0];
  if(f) fd.append("file", f);

  await fetch("/api/it/evaluate", { method:"POST", body:fd });

  alert("âœ”ï¸ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ù„Ù„Ù…Ø´ØªØ±ÙŠØ§Øª");
  loadIT();
}

// ====================== ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ ======================
function logout(){ localStorage.clear(); location.reload(); }

// ØªØ­Ù…ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
loadIT();

    async function sendPurchase(){
  const user = JSON.parse(localStorage.getItem("user") || "{}");

  const payload = {
    Ø±Ù‚Ù…_Ø§Ù„Ø·Ù„Ø¨: Date.now().toString(),
    Ø§Ù„ÙˆØµÙ: document.getElementById("desc").value,
    user: user,
    items: [{
      Ø§Ø³Ù…: document.getElementById("item_name").value,
      ÙƒÙ…ÙŠØ©: document.getElementById("item_qty").value
    }]
  };

  await fetch("/api/it/create-request", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(payload)
  });

  alert("âœ”ï¸ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡ Ù„Ù„Ù…Ø´ØªØ±ÙŠØ§Øª");
}

</script>

</body>
</html>
