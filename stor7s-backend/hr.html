<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>STOR7S | Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© (HR)</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');
body{font-family:Tajawal;background:#0b1220;color:#fff;margin:0;}
.topbar{background:#101d36;padding:15px;display:flex;justify-content:space-between;align-items:center;}
.btn{background:#3b82f6;border:0;padding:10px 15px;border-radius:8px;color:#fff;cursor:pointer;}
.btn.red{background:#ef4444;}
.btn.green{background:#22c55e;}
.btn.yellow{background:#eab308;}
.card{background:#0f1b33;padding:20px;border-radius:12px;margin:10px;}
input,select,textarea{width:100%;padding:10px;margin-top:5px;border-radius:8px;background:#162544;color:#fff;border:1px solid #243b55;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.1);}
</style>
</head>

<body>

<div class="topbar">
  <div>ğŸŸ¥ STOR7S | Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© (HR)</div>
  <button class="btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<nav style="display:flex;gap:10px;margin:10px;">
  <button class="btn" onclick="loadAll()">ğŸ“Œ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù‡Ø¯</button>
  <button class="btn" onclick="showAdd()">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù‡Ø¯Ø©</button>
  <button class="btn" onclick="showTransfer()">ğŸ” Ù†Ù‚Ù„ Ø¹Ù‡Ø¯Ø©</button>
  <button class="btn" onclick="showClose()">ğŸš« Ø¥Ù‚ÙØ§Ù„ Ø¹Ù‡Ø¯Ø©</button>
    <button class="btn" onclick="showRequest()">ğŸ§¾ Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡</button>
</nav>

<div id="request" class="card" style="display:none;">
  <h2>ğŸ§¾ Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ (HR)</h2>
  <textarea id="r_desc" placeholder="ÙˆØµÙ Ø§Ù„Ø·Ù„Ø¨"></textarea>
  <button class="btn green" onclick="createRequest()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
</div>

<!-- ================= Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù‡Ø¯ ================= -->
<div id="list" class="card">
  <h2>ğŸ“Œ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù‡Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
  <table id="tbl"><tbody></tbody></table>
</div>

<!-- ================= Ø¥Ø¶Ø§ÙØ© Ø¹Ù‡Ø¯Ø© ================= -->
<div id="add" class="card" style="display:none;">
  <h2>â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù‡Ø¯Ø© ÙŠØ¯ÙˆÙŠØ©</h2>
  <input id="a_emp" placeholder="Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø³ØªÙÙŠØ¯">
<textarea id="a_items" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù‡Ø¯ (ÙƒÙ„ Ø³Ø·Ø± ØµÙ†Ù)
Ù…Ø«Ø§Ù„:
Laptop
Phone
Screen"></textarea>
<button class="btn green" onclick="addMultiCustody()">Ø­ÙØ¸ Ø§Ù„Ø¹Ù‡Ø¯</button>

</div>

<!-- ================= Ù†Ù‚Ù„ Ø¹Ù‡Ø¯Ø© ================= -->
<div id="transfer" class="card" style="display:none;">
  <h2>ğŸ” Ù†Ù‚Ù„ Ø¹Ù‡Ø¯Ø©</h2>
  <input id="t_id" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨/Ø§Ù„Ø¹Ù‡Ø¯Ø©">
  <input id="t_new_emp" placeholder="Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯">
  <button class="btn yellow" onclick="transferCustody()">ØªÙ†ÙÙŠØ° Ø§Ù„Ù†Ù‚Ù„</button>
</div>

<!-- ================= Ø¥Ù‚ÙØ§Ù„ Ø¹Ù‡Ø¯Ø© ================= -->
<div id="close" class="card" style="display:none;">
  <h2>ğŸš« Ø¥Ù‚ÙØ§Ù„ Ø¹Ù‡Ø¯Ø©</h2>
  <input id="c_id" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨/Ø§Ù„Ø¹Ù‡Ø¯Ø©">
  <button class="btn red" onclick="closeCustody()">Ø¥Ù‚ÙØ§Ù„ Ù†Ù‡Ø§Ø¦ÙŠ</button>
</div>


<script>
const API = "http://localhost:5000/api/hr";
const USER = JSON.parse(localStorage.getItem("user")||"{}");

// ================= ÙˆØ§Ø¬Ù‡Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ø±Ø¶ =================
function showRequest(){ hideAll(); document.getElementById("request").style.display="block"; }
function showTransfer(){hideAll(); document.getElementById("transfer").style.display="block";}
function showClose(){hideAll(); document.getElementById("close").style.display="block";}
function hideAll(){
  document.getElementById("add").style.display="none";
  document.getElementById("transfer").style.display="none";
  document.getElementById("close").style.display="none";
}

// ================= Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù‡Ø¯ =================
async function loadAll(){
  let res = await fetch(API+"/custody/all");
  let data = await res.json();

  let rows = `
    <tr>
      <th>Ø±Ù‚Ù…</th>
      <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
      <th>Ø§Ù„Ù‚Ø³Ù…</th>
      <th>Ø§Ù„Ù†ÙˆØ¹</th>
      <th>Ø§Ù„ØµÙ†Ù</th>
<th>Ø§Ù„Ø³ÙŠØ±ÙŠØ§Ù„</th>
<th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>

      <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
    </tr>
  `;

  data.forEach(r=>{
    rows+=`
<tr>
  <td>${r.Ø±Ù‚Ù…_Ø§Ù„Ø¹Ù‡Ø¯Ø©}</td>
  <td>${r.Ø§Ù„Ù…ÙˆØ¸Ù}</td>
  <td>${r.Ø§Ù„Ù‚Ø³Ù…}</td>
  <td>${r.Ù†ÙˆØ¹_Ø§Ù„Ø¹Ù‡Ø¯Ø©}</td>
  <td>${r.Ø§Ø³Ù…_Ø§Ù„ØµÙ†Ù || "-"}</td>
  <td>${r.Ø³ÙŠØ±ÙŠØ§Ù„ || "-"}</td>
  <td>${r.Ø§Ù„ÙƒÙ…ÙŠØ©}</td>
  <td>
  ${r.Ø§Ù„Ø­Ø§Ù„Ø©}
  <br>
  <button class="btn green" onclick="receive('${r.Ø±Ù‚Ù…_Ø§Ù„Ø¹Ù‡Ø¯Ø©}')">Ø§Ø³ØªÙ„Ø§Ù…</button>
  <button class="btn yellow" onclick="dispatch('${r.Ø±Ù‚Ù…_Ø§Ù„Ø¹Ù‡Ø¯Ø©}')">ØªØ³Ù„ÙŠÙ…</button>
</td>
</tr>
`;

  });

  document.querySelector("#tbl").innerHTML = rows;
}

// ================= Ø¥Ø¶Ø§ÙØ© Ø¹Ù‡Ø¯Ø© =================
async function addCustody(){
  let data = {
    Ø±Ù‚Ù…_Ø§Ù„Ø¹Ù‡Ø¯Ø©: "CST-" + Date.now(),
    Ø§Ù„Ù…ÙˆØ¸Ù: document.getElementById("a_emp").value,
    Ø§Ù„Ù‚Ø³Ù…: USER.department,
    Ù†ÙˆØ¹_Ø§Ù„Ø¹Ù‡Ø¯Ø©: document.getElementById("a_type").value,
    Ø³ÙŠØ±ÙŠØ§Ù„: document.getElementById("a_serial").value,
    Ø§Ù„ÙƒÙ…ÙŠØ©: 1,
    Ù…Ù„Ø§Ø­Ø¸Ø§Øª: document.getElementById("a_note").value
  };

  let r = await fetch(API+"/custody/add",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(data)
  });

  let res = await r.json();
  if(res.ok){
    alert("âœ”ï¸ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù‡Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­");
    loadAll();
  }
}


// ================= Ù†Ù‚Ù„ Ø¹Ù‡Ø¯Ø© =================
async function transferCustody(){
  let data = {
  Ø±Ù‚Ù…_Ø§Ù„Ø¹Ù‡Ø¯Ø©: document.getElementById("t_id").value,
  Ø§Ù„Ù…ÙˆØ¸Ù: document.getElementById("t_new_emp").value
};


  let r = await fetch(API+"/custody/transfer",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(data)
  });

  if(r.ok){
    alert("âœ”ï¸ ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ø¹Ù‡Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­");
    loadAll();
  }
}


// ================= Ø¥Ù‚ÙØ§Ù„ Ø¹Ù‡Ø¯Ø© =================
async function closeCustody(){
  alert("ğŸš« ØªÙ… Ø¥Ù‚ÙØ§Ù„ Ø§Ù„Ø¹Ù‡Ø¯Ø© (Ø³ÙŠØªÙ… ØªÙˆØ«ÙŠÙ‚Ù‡Ø§ ÙÙŠ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ù„Ø§Ø­Ù‚Ù‹Ø§)");
}

// ================= ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ =================
function logout(){localStorage.clear();location.reload();}

// ØªØ­Ù…ÙŠÙ„
loadAll();

    async function createRequest(){
  let data = {
    Ø§Ù„Ø±Ø§ÙØ¹: USER.name,
    Ø§Ù„Ù‚Ø³Ù…: USER.department,
    Ø§Ù„Ø´Ø±ÙƒØ©: USER.company,
    Ø§Ù„ÙØ±Ø¹: USER.branch,
    Ø§Ù„Ù†ÙˆØ¹: "Ø´Ø±Ø§Ø¡",
    Ø§Ù„ÙˆØµÙ: document.getElementById("r_desc").value
  };

  let r = await fetch(API+"/request/create",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(data)
  });

  let res = await r.json();
  if(res.ok){
    alert("âœ”ï¸ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ø±Ù‚Ù… " + res.Ø±Ù‚Ù…_Ø§Ù„Ø·Ù„Ø¨);
    document.getElementById("r_desc").value="";
  }
}


    async function addMultiCustody(){
  let items = document.getElementById("a_items").value
    .split("\n")
    .filter(x=>x.trim())
    .map(x=>({ Ø§Ø³Ù…:x.trim() }));

  let data = {
  Ø§Ù„Ù…ÙˆØ¸Ù: document.getElementById("a_emp").value,
  items: items
};



  let r = await fetch(API+"/custody/add-multi",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(data)
  });

  let res = await r.json();
  if(res.ok){
    alert("âœ”ï¸ ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù‡Ø¯");
    loadAll();
  }
}


    async function receive(id){
  await fetch(API+"/custody/receive",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({Ø±Ù‚Ù…_Ø§Ù„Ø¹Ù‡Ø¯Ø©:id})
  });
  loadAll();
}

async function dispatch(id){
  await fetch(API+"/custody/dispatch",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({Ø±Ù‚Ù…_Ø§Ù„Ø¹Ù‡Ø¯Ø©:id})
  });
  loadAll();
}

    function showAdd(){
  hideAll();
  document.getElementById("add").style.display="block";
}

</script>

</body>
</html>
